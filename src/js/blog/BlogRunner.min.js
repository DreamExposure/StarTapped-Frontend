let timeIndex=new TimeIndex,keepChecking=!0,isGenerating=!1,isBlocking=!1,blog=null,account=null;function doLoadBlog(){initOnBlogPage(),getOwnAccount()}function showBlog(){let e=document.getElementById("post-container"),t=document.createElement("div");if(t.className="blog-container rounded",t.id="blog-"+blog.id,t.style.backgroundColor=blog.backgroundColor,e.appendChild(t),account.safeSearch&&blog.nsfw){isBlocking=!0;let e=document.createElement("p");e.className="blog-content-alert-header text-light bg-danger rounded-top",e.innerText="Content Alert",t.appendChild(e);let n=document.createElement("p");n.className="blog-content-alert-description text-dark",n.innerText="This blog is marked as NSFW (Not Safe For Work). Please disable safe search to view this blog.",t.appendChild(n)}else if(!blog.allowUnder18&&account.age<18){isBlocking=!0;let e=document.createElement("p");e.className="blog-content-alert-header text-light bg-danger rounded-top",e.innerText="Content Alert",t.appendChild(e);let n=document.createElement("p");n.className="blog-content-alert-description text-dark",n.innerText="This blog does not allow minors to view. Please come back when you are at least 18 years old.",t.appendChild(n)}else{let e=document.createElement("img");e.className="blog-header-img rounded-top",e.src=blog.backgroundImage.url,e.alt=blog.backgroundImage.name,t.appendChild(e);let n=document.createElement("a");n.className="text-link-color underline-solid blog-link",n.href=blog.completeUrl,n.target="_blank",n.innerHTML=blog.baseUrl,t.appendChild(n);let o=document.createElement("img");if(o.className="blog-profile-img rounded",o.src=blog.iconImage.url,o.alt=blog.iconImage.name,t.appendChild(o),blog.nsfw){let e=document.createElement("span");e.className="blog-nsfw-badge badge badge-danger",e.innerHTML="NSFW",t.appendChild(e)}if(!blog.allowUnder18){let e=document.createElement("span");e.className="blog-18-only-badge badge badge-danger",e.innerHTML="18+ Only",t.appendChild(e)}if("PERSONAL"===blog.blogType&&blog.displayAge){let e=document.createElement("span");e.className="blog-age-badge badge badge-danger",showAge(e),t.appendChild(e)}let a=document.createElement("div");a.className="blog-text-container",t.appendChild(a);let l=document.createElement("h3");l.className="blog-title text-primary font-weight-bold",l.innerHTML=blog.name.replace(/(?:\r\n|\r|\n)/g,"<br>"),a.appendChild(l);let s=document.createElement("p");s.className="blog-desc text-dark",s.innerHTML=blog.description.replace(/(?:\r\n|\r|\n)/g,"<br>"),a.appendChild(s),getPostsFromServer()}setupNavBar()}function setupNavBar(){if(!isBlocking){let e=document.getElementById("navbar-container");if(blog.ownerId===account.id||blog.owners.indexOf(account.id)>-1){let t=document.createElement("button");t.className="btn btn-primary",t.innerText="Followers",t.onclick=function(e){showSnackbar(blog.followers.length+" follower(s)")},e.appendChild(t)}else if(blog.followers.indexOf(account.id)>-1){let t=document.createElement("button");t.className="btn btn-primary",t.innerText="Unfollow",t.onclick=function(e){unfollowBlog()},e.appendChild(t)}else{let t=document.createElement("button");t.className="btn btn-primary",t.innerText="Follow",t.onclick=function(e){followBlog()},e.appendChild(t);let n=document.createElement("button");n.className="btn btn-primary",n.innerText="Report",n.onclick=function(e){},e.appendChild(n);let o=document.createElement("button");o.className="btn btn-primary",o.innerText="Block",o.onclick=function(e){},e.appendChild(o)}}}function showPosts(e){if(isGenerating=!0,e.count<=0)keepChecking=!1,showSnackbar("No most posts!");else{e.range.latest>0&&(timeIndex.latest=e.range.latest,timeIndex.oldest=e.range.oldest);let t=[];for(let n=0;n<e.count;n++)t.push((new Post).fromJson(e.posts[n]));t.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)});let n=document.getElementById("post-container");for(let e=0;e<t.length;e++){let o=t[e];if(o.timestamp>=timeIndex.oldest&&o.timestamp<=timeIndex.latest&&o.originBlog.id===blog.id)if("Unassigned"!==o.parent)n.appendChild(generatePostTree(o,t));else{let e=null;"TEXT"===o.postType?e=generateTextPost(o,null,!0,!0,!0):"IMAGE"===o.postType?e=generateImagePost(o,null,!0,!0,!0):"AUDIO"===o.postType?e=generateAudioPost(o,null,!0,!0,!0):"VIDEO"===o.postType&&(e=generateVideoPost(o,null,!0,!0,!0)),null!=e&&n.appendChild(e)}}}timeIndex.before=timeIndex.oldest-1,isGenerating=!1}function getOwnAccount(){$.ajax({url:"https://api.startapped.com/v1/account/get",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",success:function(e){account=(new Account).fromJson(e.account),getBlogByBaseUrl()},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}function getBlogByBaseUrl(){let e={url:window.location.host.split(".")[0]};$.ajax({url:"https://api.startapped.com/v1/blog/get",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){blog=(new Blog).fromJson(e.blog),document.title=blog.baseUrl+" :: StarTapped",document.getElementById("navbar-brand").innerText=blog.baseUrl,showBlog()},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}function getPostsFromServer(){if(!isGenerating&&keepChecking&&!isBlocking){let e={blog_id:blog.id,before:timeIndex.before,limit:20};$.ajax({url:"https://api.startapped.com/v1/post/get/blog",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){showPosts(e)},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}}function followBlog(){let e={blog_id:blog.id};$.ajax({url:"https://api.startapped.com/v1/relation/follow",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){showSnackbar("Success!"),window.location.reload(!1)},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}function unfollowBlog(){let e={blog_id:blog.id};$.ajax({url:"https://api.startapped.com/v1/relation/unfollow",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){showSnackbar("Success!"),window.location.reload(!1)},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}function showAge(e){let t={id:blog.ownerId};$.ajax({url:"https://api.startapped.com/v1/account/get/other",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(t),success:function(t){let n=(new Account).fromJson(t.account);e.innerHTML=n.age},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}window.onscroll=function(){window.innerHeight+window.scrollY>=document.body.scrollHeight&&getPostsFromServer()};