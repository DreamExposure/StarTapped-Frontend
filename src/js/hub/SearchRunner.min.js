let timeIndex=new TimeIndex,keepChecking=!0,isGenerating=!1,currentTags=[];function doLoadOnSearch(){initOnHub(),checkAndSearchFromUrl()}function searchFromSearchBar(){if(!isGenerating){let e=document.getElementById("search-input").value;if(e.length<=0||e.trim().length<=0)return void showSnackbar("You can't search for nothing.");let t=document.getElementById("post-container");for(;t.firstChild;)t.removeChild(t.firstChild);timeIndex=new TimeIndex,currentTags=[],keepChecking=!0;let n=e.split(",");for(let e=0;e<n.length;e++){let t=n[e].trim();t.length>0&&currentTags.push(t)}getPostsFromServerForSearch()}}function checkAndSearchFromUrl(){let e=!1,t=getUrlParameter("tags");if(t.length>0){document.getElementById("search-input").value=t,currentTags=[];let n=t.split(",");for(let e=0;e<n.length;e++){let t=n[e].trim();t.length>0&&currentTags.push(t)}currentTags.length>0&&(e=!0)}if(e){let e=document.getElementById("post-container");for(;e.firstChild;)e.removeChild(e.firstChild);timeIndex=new TimeIndex,keepChecking=!0,getPostsFromServerForSearch()}}function showPosts(e){if(isGenerating=!0,e.count<=0)keepChecking=!1,showSnackbar("No most posts!");else{e.range.latest>0&&(timeIndex.latest=e.range.latest,timeIndex.oldest=e.range.oldest);let t=[];for(let n=0;n<e.count;n++)t.push((new Post).fromJson(e.posts[n]));t.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)});let n=document.getElementById("post-container");for(let e=0;e<t.length;e++){let r=t[e];if(r.timestamp>=timeIndex.oldest&&r.timestamp<=timeIndex.latest)if("Unassigned"!==r.parent)n.appendChild(generatePostTree(r,t));else{let e=null;"TEXT"===r.postType?e=generateTextPost(r,null,!0,!0,!0):"IMAGE"===r.postType?e=generateImagePost(r,null,!0,!0,!0):"AUDIO"===r.postType?e=generateAudioPost(r,null,!0,!0,!0):"VIDEO"===r.postType&&(e=generateVideoPost(r,null,!0,!0,!0)),null!=e&&n.appendChild(e)}}}timeIndex.before=timeIndex.oldest-1,isGenerating=!1}function getPostsFromServerForSearch(){if(!isGenerating&&keepChecking){let e={before:timeIndex.before,limit:20};currentTags.length>0&&(e.filters=currentTags),$.ajax({url:"https://api.startapped.com/v1/post/get/search",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){showPosts(e)},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}}window.onscroll=function(){window.innerHeight+window.scrollY>=document.body.scrollHeight&&getPostsFromServerForSearch(currentTags)};