let timeIndex=new TimeIndex,keepChecking=!0,isGenerating=!1;function doLoadOnBookmarks(){initOnHub(),getPostsFromServer()}function showPosts(e){if(isGenerating=!0,e.count<=0)keepChecking=!1,showSnackbar("No most posts!");else{e.range.latest>0&&(timeIndex.latest=e.range.latest,timeIndex.oldest=e.range.oldest);let t=[];for(let n=0;n<e.count;n++)t.push((new Post).fromJson(e.posts[n]));t.sort(function(e,t){return new Date(t.timestamp)-new Date(e.timestamp)});let n=document.getElementById("post-container");for(let e=0;e<t.length;e++){let o=t[e];if(o.timestamp>=timeIndex.oldest&&o.timestamp<=timeIndex.latest&&o.bookmarked)if("Unassigned"!==o.parent)n.appendChild(generatePostTree(o,t));else{let e=null;"TEXT"===o.postType?e=generateTextPost(o,null,!0,!0,!0):"IMAGE"===o.postType?e=generateImagePost(o,null,!0,!0,!0):"AUDIO"===o.postType?e=generateAudioPost(o,null,!0,!0,!0):"VIDEO"===o.postType&&(e=generateVideoPost(o,null,!0,!0,!0)),null!=e&&n.appendChild(e)}}}timeIndex.before=timeIndex.oldest-1,isGenerating=!1}function getPostsFromServer(){if(!isGenerating&&keepChecking){let e={before:timeIndex.before,limit:20};$.ajax({url:"https://api.startapped.com/v1/post/get/bookmark",headers:{"Content-Type":"application/json",Authorization_Access:getCredentials().access,Authorization_Refresh:getCredentials().refresh},method:"POST",dataType:"json",data:JSON.stringify(e),success:function(e){showPosts(e)},error:function(e,t,n){showSnackbar(JSON.parse(e.responseText).message)}})}}window.onscroll=function(){window.innerHeight+window.scrollY>=document.body.scrollHeight&&getPostsFromServer()};